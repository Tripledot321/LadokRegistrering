<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betygsregistrering</title>
</head>
<body>
    <label for="courseCodeDropdown">Kurskod:</label>
    <select id="courseCodeDropdown"></select>

    <label for="assignmentDropdown">Uppgift i Canvas:</label>
    <select id="assignmentDropdown" multiple></select>

    <label for="moduleDropdown">Modul i Ladok:</label>
    <select id="moduleDropdown"></select>

    <label for="examDate">Examinationsdatum:</label>
    <input type="date" id="examDate" />

    <button type="button" onclick="">Skicka in</button>

    <ul id="studentList"></ul>

<script>
    async function getCourseCodes() {
    try {
        const response = await fetch('http://localhost:3000/epok/get_AllCourseCodes');
        console.log('Response:', response);

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data = await response.json();
        console.log('Data:', data);

        const courses = data.courseCodes; // Update to access 'courses' property

        const courseCodeDropdown = document.getElementById('courseCodeDropdown');
        courseCodeDropdown.innerHTML = '';

        // Add default option
        const defaultOption = document.createElement('option');
        defaultOption.value = ''; // Adjust to your needs
        defaultOption.text = '- Välj Kurs -';
        courseCodeDropdown.appendChild(defaultOption);

        courses.forEach(course => {
            const option = document.createElement('option');
            option.value = course;
            option.text = course;
            courseCodeDropdown.appendChild(option);
        });
        // Add event listener for course selection
        courseCodeDropdown.addEventListener('change', () => {
        const selectedCourseCode = courseCodeDropdown.value;
        getModulesForCourse(selectedCourseCode);
        getAssignmentsForCourse(selectedCourseCode);
        });

        // Initial call to getModulesForCourse with the default course code (empty string)
        getModulesForCourse('');
        getAssignmentsForCourse('');
    } catch (error) {
        console.error('Error:', error);
    }
}

async function getModulesForCourse(courseCode) {
    try {
        // Fetch modules based on the selected courseCode
        const response = await fetch(`http://localhost:3000/epok/get_Module?courseCode=${courseCode}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        // Parse the response
        const data = await response.json();
        console.log('Modules:', data.activeModules);

        // Populate the module dropdown
        const moduleDropdown = document.getElementById('moduleDropdown');
        moduleDropdown.innerHTML = '';

        // Add default option
        const defaultModuleOption = document.createElement('option');
        defaultModuleOption.value = ''; // Adjust to your needs
        defaultModuleOption.text = '- Välj Modul -';
        moduleDropdown.appendChild(defaultModuleOption);

        // Check if activeModules is defined before using it
        if (data.activeModules) {
            // Populate the dropdown with module data
            data.activeModules.forEach(module => {
                const moduleOption = document.createElement('option');
                moduleOption.value = module.Code; // Adjust to access the appropriate property
                moduleOption.text = module.Description; // Adjust to access the appropriate property
                moduleDropdown.appendChild(moduleOption);
            });
        } else {
            console.error('No module data found.');
        }

    } catch (error) {
        console.error('Error fetching modules for the course:', error);
    }
}

async function getAssignmentsForCourse(courseCode) {
    try {
        // Fetch modules based on the selected courseCode
        const response = await fetch(`http://localhost:3000/canvas/get_Assignments?courseCode=${courseCode}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        // Parse the response
        const data = await response.json();

        // Populate the module dropdown
        const assignmentDropdown = document.getElementById('assignmentDropdown');
        assignmentDropdown.innerHTML = '';

        // Add default option
        const defaultAssignmentOption = document.createElement('option');
        defaultAssignmentOption.value = ''; // Adjust to your needs
        defaultAssignmentOption.text = '- Välj Assignments -';
        assignmentDropdown.appendChild(defaultAssignmentOption);

        // Check if activeModules is defined before using it
        if (data.assignments) {
            data.assignments.forEach(assignment => {
            const assignmentOption = document.createElement('option');
            assignmentOption.value = assignment.assignmentId;
            assignmentOption.text = assignment.assignment;
            assignmentDropdown.appendChild(assignmentOption);
            });
        assignmentDropdown.multiple = true;
        } else {
            console.error('No assignments found.');
        }
    } catch (error) {
        console.error('Error fetching assignments for the course:', error);
    }
};
// Assignment

function updateStudentList() {
    const studentList = document.getElementById('studentList');
    studentList.innerHTML = '';

    // Dummy data
    const studentsData = [
        { name: 'John Doe', canvasGrade: 'A', ladokGrade: 'VG', examDate: '2023-01-01', status: 'Completed', info: 'Details 1' },
        { name: 'Jane Smith', canvasGrade: 'B', ladokGrade: 'G', examDate: '2023-01-15', status: 'In Progress', info: 'Details 2' },
        // Add more student data as needed
    ];

// Add field names at the top
const fieldNames = ['Namn', 'Omdöme i Canvas', 'Betyg i Ladok', 'Examinationsdatum', 'Status', 'Information'];
const fieldNamesRow = document.createElement('li');
fieldNamesRow.style.display = 'flex';
fieldNamesRow.style.listStyle = 'none'; // Remove default list styling

fieldNames.forEach(fieldName => {
    const fieldNameElement = document.createElement('div');
    fieldNameElement.style.flex = '1'; // Make each column equally distributed
    fieldNameElement.innerHTML = `<strong>${fieldName}:</strong>`;
    fieldNamesRow.appendChild(fieldNameElement);
});

studentList.appendChild(fieldNamesRow);

// Add student data
studentsData.forEach(student => {
    const listItem = document.createElement('li');
    listItem.style.display = 'flex';
    listItem.style.listStyle = 'none'; // Remove default list styling

    // Add a div for the selectable area
    const selectableArea = document.createElement('div');
    selectableArea.style.width = '20px'; // Adjust width as needed
    selectableArea.style.height = '20px'; // Adjust height as needed
    selectableArea.style.border = '1px solid #ccc'; // Add border for styling
    selectableArea.style.cursor = 'pointer'; // Change cursor to indicate clickability

    // Add "x" button inside the selectable area
    const selectButton = document.createElement('span');
    selectButton.innerHTML = 'x';
    selectButton.style.visibility = 'hidden'; // Initially hidden
    selectButton.style.display = 'block'; // Display as a block
    selectButton.style.margin = 'auto'; // Center the "x" inside the div

    // Add click event listener to toggle visibility
    selectableArea.addEventListener('click', () => {
        selectButton.style.visibility = selectButton.style.visibility === 'hidden' ? 'visible' : 'hidden';
        // Handle selection logic here if needed
    });

    // Append the "x" button to the selectable area
    selectableArea.appendChild(selectButton);

    // Append the selectable area to the list item
    listItem.appendChild(selectableArea);

    Object.entries(student).forEach(([key, value]) => {
        const dataElement = document.createElement('div');
        dataElement.style.flex = '1'; // Make each column equally distributed
        dataElement.style.marginRight = '20px';

        if (key === 'examDate') {
            // If it's the "Examinationsdatum" field, use a date input
            const dateInput = document.createElement('input');
            dateInput.type = 'date';
            dateInput.value = value;
            dateInput.addEventListener('input', () => {
                // Handle date changes if needed
                console.log(dateInput.value);
            });
            dataElement.appendChild(dateInput);
        } else {
            dataElement.innerHTML = `${value}`;
        }

        listItem.appendChild(dataElement);
    });

    studentList.appendChild(listItem);
});
};

getCourseCodes();
updateStudentList();
</script>
</body>
</html>

